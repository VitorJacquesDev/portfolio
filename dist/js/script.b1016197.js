if('serviceWorker' in navigator){window.addEventListener('load',()=>{navigator.serviceWorker.register('/service-worker.js').then(registration =>{console.log('Service Worker registrado com sucesso:',registration.scope);}).catch(error =>{console.log('Falha ao registrar o Service Worker:',error);});});}let refreshing;navigator.serviceWorker.addEventListener('controllerchange',()=>{if(refreshing)return;refreshing = true;window.location.reload();});const header = document.querySelector('header');const mobileMenuBtn = document.querySelector('.mobile-menu-btn');const mobileNav = document.querySelector('.mobile-nav');const backToTopBtn = document.querySelector('.back-to-top');const filterBtns = document.querySelectorAll('.filter-btn');const projectCards = document.querySelectorAll('.project-card');const navLinks = document.querySelectorAll('header nav a,.mobile-nav a');const contactForm = document.getElementById('contactForm');const langBtns = document.querySelectorAll('.lang-btn');mobileMenuBtn.addEventListener('click',()=>{const isActive = mobileMenuBtn.classList.toggle('active');mobileNav.classList.toggle('active');mobileMenuBtn.setAttribute('aria-expanded',isActive);mobileNav.setAttribute('aria-hidden',!isActive);const bars = mobileMenuBtn.querySelectorAll('.bar');if(isActive){bars[0].style.transform = 'rotate(45deg)translate(5px,5px)';bars[1].style.opacity = '0';bars[2].style.transform = 'rotate(-45deg)translate(7px,-6px)';document.body.style.overflow = 'hidden';setTimeout(()=>{const firstLink = mobileNav.querySelector('a');if(firstLink)firstLink.focus();},300);}else{bars[0].style.transform = 'none';bars[1].style.opacity = '1';bars[2].style.transform = 'none';document.body.style.overflow = 'auto';}});document.addEventListener('keydown',(e)=>{if(e.key === 'Escape' && mobileNav.classList.contains('active')){mobileMenuBtn.click();mobileMenuBtn.focus();}});navLinks.forEach(link =>{link.addEventListener('click',()=>{if(mobileNav.classList.contains('active')){mobileMenuBtn.click();}});});window.addEventListener('scroll',()=>{if(window.scrollY > 50){header.classList.add('scrolled');backToTopBtn.classList.add('active');}else{header.classList.remove('scrolled');backToTopBtn.classList.remove('active');}updateActiveNavLink();});function updateActiveNavLink(){const sections = document.querySelectorAll('section');const scrollPosition = window.scrollY + 100;sections.forEach(section =>{const sectionTop = section.offsetTop;const sectionHeight = section.offsetHeight;const sectionId = section.getAttribute('id');if(scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight){document.querySelectorAll('nav a').forEach(link =>{link.classList.remove('active');link.removeAttribute('aria-current');if(link.getAttribute('href')=== `#${sectionId}`){link.classList.add('active');link.setAttribute('aria-current','page');}});}});}langBtns.forEach(btn =>{btn.addEventListener('click',async()=>{const lang = btn.getAttribute('data-lang');if(typeof i18nManager !== 'undefined'){const success = await i18nManager.setLanguage(lang);if(success){langBtns.forEach(b =>{b.classList.remove('active');b.setAttribute('aria-pressed','false');});btn.classList.add('active');btn.setAttribute('aria-pressed','true');announceLanguageChange(lang);}}});});function announceLanguageChange(lang){const langNames ={'pt-BR':'Português','en-US':'English','es-ES':'Español'};const announcement = document.createElement('div');announcement.setAttribute('role','status');announcement.setAttribute('aria-live','polite');announcement.className = 'sr-only';announcement.textContent = `Language changed to ${langNames[lang]}`;document.body.appendChild(announcement);setTimeout(()=> announcement.remove(),1000);}filterBtns.forEach(btn =>{btn.addEventListener('click',()=>{if(btn.classList.contains('active'))return;btn.classList.add('activating');setTimeout(()=> btn.classList.remove('activating'),300);filterBtns.forEach(b =>{b.classList.remove('active');b.setAttribute('aria-pressed','false');});btn.classList.add('active');btn.setAttribute('aria-pressed','true');const filterValue = btn.getAttribute('data-filter');const projectsGrid = document.querySelector('.projects-grid');projectsGrid.classList.add('reflowing');const cardsToHide = [];const cardsToShow = [];projectCards.forEach(card =>{const category = card.getAttribute('data-category');const shouldShow = filterValue === 'all' || category === filterValue;if(shouldShow){cardsToShow.push(card);}else{cardsToHide.push(card);}});cardsToHide.forEach((card,index)=>{card.classList.remove('filtering-in','filtered-in');card.classList.add('filtering-out');setTimeout(()=>{card.classList.add('filtered-out');card.classList.remove('filtering-out');},400);});setTimeout(()=>{cardsToShow.forEach((card,index)=>{card.classList.remove('filtering-out','filtered-out');card.classList.add('filtered-in');void card.offsetWidth;card.classList.add('filtering-in');setTimeout(()=>{card.classList.remove('filtering-in');},500 +(index * 50));});setTimeout(()=>{projectsGrid.classList.remove('reflowing');checkEmptyState(cardsToShow.length);},600);},200);});});function checkEmptyState(visibleCount){const projectsSection = document.querySelector('.projects');let emptyState = projectsSection.querySelector('.projects-empty-state');if(visibleCount === 0){if(!emptyState){emptyState = document.createElement('div');emptyState.className = 'projects-empty-state';emptyState.innerHTML = ` <i class="fas fa-search"></i> <h3 data-i18n="projects.noResults">No projects found</h3> <p data-i18n="projects.noResultsDesc">Try selecting a different category</p> `;const projectsGrid = document.querySelector('.projects-grid');projectsGrid.parentNode.insertBefore(emptyState,projectsGrid.nextSibling);}else{emptyState.style.display = 'block';void emptyState.offsetWidth;emptyState.style.animation = 'none';setTimeout(()=>{emptyState.style.animation = '';},10);}}else{if(emptyState){emptyState.style.display = 'none';}}}function createProjectSkeleton(){const skeleton = document.createElement('div');skeleton.className = 'project-skeleton';skeleton.innerHTML = ` <div class="project-skeleton-image"></div> <div class="project-skeleton-content"> <div class="project-skeleton-tags"> <div class="project-skeleton-tag"></div> <div class="project-skeleton-tag"></div> <div class="project-skeleton-tag"></div> </div> <div class="project-skeleton-title"></div> <div class="project-skeleton-description"></div> <div class="project-skeleton-links"> <div class="project-skeleton-link"></div> <div class="project-skeleton-link"></div> </div> </div> `;return skeleton;}function showProjectSkeletons(count = 3){const projectsGrid = document.querySelector('.projects-grid');projectsGrid.innerHTML = '';for(let i = 0;i < count;i++){const skeleton = createProjectSkeleton();projectsGrid.appendChild(skeleton);}}function hideProjectSkeletons(){const skeletons = document.querySelectorAll('.project-skeleton');skeletons.forEach((skeleton,index)=>{setTimeout(()=>{skeleton.style.opacity = '0';setTimeout(()=> skeleton.remove(),300);},index * 50);});}function setupProjectCardHandlers(){projectCards.forEach((card,index)=>{const projectId = card.dataset.projectId || `project${index + 1}`;const overlay = card.querySelector('.project-overlay');const overlayClose = card.querySelector('.project-overlay-close');const isTouchDevice = !window.matchMedia('(hover:hover)and(pointer:fine)').matches;if(isTouchDevice && overlay){let overlayVisible = false;card.addEventListener('click',(e)=>{if(e.target.closest('.project-links a')){return;}if(e.target.closest('.project-overlay-close')){e.preventDefault();e.stopPropagation();card.classList.remove('overlay-active');overlayVisible = false;return;}if(!overlayVisible && !e.target.closest('.project-overlay-cta')){e.preventDefault();e.stopPropagation();document.querySelectorAll('.project-card.overlay-active').forEach(c =>{if(c !== card){c.classList.remove('overlay-active');}});card.classList.add('overlay-active');overlayVisible = true;return;}if(overlayVisible || e.target.closest('.project-overlay-cta')){e.preventDefault();openProjectModal(card,projectId);card.classList.remove('overlay-active');overlayVisible = false;}});document.addEventListener('click',(e)=>{if(!card.contains(e.target)&& overlayVisible){card.classList.remove('overlay-active');overlayVisible = false;}});}else{card.addEventListener('click',(e)=>{if(e.target.closest('.project-links a')){return;}e.preventDefault();openProjectModal(card,projectId);});}card.setAttribute('tabindex','0');card.setAttribute('role','button');const projectTitle = card.querySelector('h3')?.textContent || 'project';card.setAttribute('aria-label',`View details for ${projectTitle}`);card.addEventListener('keydown',(e)=>{if(e.key === 'Enter' || e.key === ' '){e.preventDefault();openProjectModal(card,projectId);}if(e.key === 'Escape' && card.classList.contains('overlay-active')){card.classList.remove('overlay-active');}});card.addEventListener('mouseenter',()=>{card.style.cursor = 'pointer';});});}function openProjectModal(card,projectId){if(typeof projectsData !== 'undefined' && typeof projectModal !== 'undefined'){const projectData = projectsData[projectId];if(projectData){card.classList.add('opening-modal');setTimeout(()=>{projectModal.open(projectData);card.classList.remove('opening-modal');},150);}else{console.warn(`Project data not found for ID:${projectId}`);}}else{console.warn('Project modal or data not initialized');}}function initializeProjectCards(){if(typeof projectsData === 'undefined' || typeof projectModal === 'undefined'){console.warn('Waiting for project dependencies to load...');setTimeout(initializeProjectCards,100);return;}setupProjectCardHandlers();}if(document.readyState === 'loading'){document.addEventListener('DOMContentLoaded',initializeProjectCards);}else{initializeProjectCards();}document.querySelectorAll('a[href^="#"]').forEach(anchor =>{anchor.addEventListener('click',function(e){e.preventDefault();const targetId = this.getAttribute('href');if(targetId === '#')return;const targetElement = document.querySelector(targetId);if(targetElement){const headerOffset = 80;const elementPosition = targetElement.getBoundingClientRect().top;const offsetPosition = elementPosition + window.pageYOffset - headerOffset;window.scrollTo({top:offsetPosition,behavior:'smooth'});}});});let formHandler;function initializeFormHandler(){if(contactForm && typeof FormHandler !== 'undefined'){formHandler = new FormHandler('contactForm',{validateOnBlur:true,validateOnInput:false,showSuccessMessage:true,clearOnSuccess:true,emailService:'formsubmit',emailServiceConfig:{email:'vitorjacquesdev@gmail.com'},onSuccess:()=>{console.log('Form submitted successfully');},onError:(error)=>{console.error('Form submission error:',error);}});}else if(!contactForm){console.warn('Contact form not found');}else{console.warn('FormHandler not loaded,retrying...');setTimeout(initializeFormHandler,100);}}if(document.readyState === 'loading'){document.addEventListener('DOMContentLoaded',initializeFormHandler);}else{initializeFormHandler();}const animateOnScroll =()=>{const elements = document.querySelectorAll('.animate-on-scroll');elements.forEach(element =>{const elementPosition = element.getBoundingClientRect().top;const windowHeight = window.innerHeight;if(elementPosition < windowHeight - 100){element.classList.add('animated');}});};window.addEventListener('DOMContentLoaded',()=>{document.querySelectorAll('.hero-text h1,.hero-text h4,.hero-text p,.hero-buttons,.social-icons').forEach(el =>{el.classList.add('animate-on-scroll');});document.querySelectorAll('.section-header,.about-image,.about-text,.skill-category,.project-card,.contact-info,.contact-form').forEach(el =>{el.classList.add('animate-on-scroll');});animateOnScroll();window.addEventListener('scroll',animateOnScroll);});const styleSheet = document.createElement('style');styleSheet.textContent = ` .animate-on-scroll{opacity:0;transform:translateY(30px);transition:opacity 0.6s ease,transform 0.6s ease;}.animate-on-scroll.animated{opacity:1;transform:translateY(0);}.hero-text h4.animated{transition-delay:0.2s;}.hero-text h1.animated{transition-delay:0.4s;}.hero-text p.animated{transition-delay:0.6s;}.hero-buttons.animated{transition-delay:0.8s;}.social-icons.animated{transition-delay:1s;}`;document.head.appendChild(styleSheet);const heroTitle = document.querySelector('.hero-text h1');if(heroTitle){const originalText = heroTitle.innerHTML;heroTitle.innerHTML = '';window.addEventListener('DOMContentLoaded',()=>{setTimeout(()=>{let i = 0;const typeWriter =()=>{if(i < originalText.length){heroTitle.innerHTML += originalText.charAt(i);i++;setTimeout(typeWriter,100);}};typeWriter();},500);});}if(typeof AOS !== 'undefined'){AOS.init({duration:800,easing:'ease-in-out',once:true});}let lazyLoader;if(document.readyState === 'loading'){document.addEventListener('DOMContentLoaded',initializeLazyLoading);}else{initializeLazyLoading();}function initializeLazyLoading(){if(typeof LazyLoader !== 'undefined'){lazyLoader = new LazyLoader();lazyLoader.init();console.log('Lazy loading initialized');}else{console.warn('LazyLoader class not found. Make sure lazy-loader.js is loaded.');}}let performanceMonitor;if(typeof PerformanceMonitor !== 'undefined'){performanceMonitor = new PerformanceMonitor({enableLogging:true,enableReporting:false,reportingEndpoint:null,sampleRate:1.0});performanceMonitor.init();window.addEventListener('load',()=>{setTimeout(()=>{performanceMonitor.logMetrics();},3000);});window.performanceMonitor = performanceMonitor;console.log('Performance monitoring initialized. Use window.performanceMonitor.logMetrics()to view current metrics.');}else{console.warn('PerformanceMonitor class not found. Make sure performance-monitor.js is loaded.');}